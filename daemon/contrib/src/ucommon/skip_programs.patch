From 39dee37710777870dfb4fc57f7d238b89aff525e Mon Sep 17 00:00:00 2001
From: Tristan Matthews <tristan.matthews@savoirfairelinux.com>
Date: Wed, 8 Oct 2014 16:11:59 -0400
Subject: [PATCH] configure: provide options to skip tests/utils

---
 Makefile.am  |  8 +++++++-
 configure.ac | 14 ++++++++++++++
 2 files changed, 21 insertions(+), 1 deletion(-)

diff --git a/Makefile.am b/Makefile.am
index 6adb84c..56f3453 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -15,7 +15,13 @@ EXTRA_DIST = autogen.sh README* *.pc.in *.spec.in *.spec *-config.in \
     ucommon-config.h.cmake doxy.config.cmake directive.in
 
 DIST_SUBDIRS = corelib commoncpp openssl gnutls nossl utils inc test
-SUBDIRS = corelib @SECURE@ @COMPAT@ utils inc test
+SUBDIRS = corelib @SECURE@ @COMPAT@ inc
+if BUILD_UTILS
+SUBDIRS += utils
+endif
+if BUILD_TESTS
+SUBDIRS += test
+endif
 EXTRA_SCRIPTS = commoncpp-config
 
 pkgconfigdir = $(libdir)/pkgconfig
diff --git a/configure.ac b/configure.ac
index 10938a3..abf14eb 100644
--- a/configure.ac
+++ b/configure.ac
@@ -120,6 +120,20 @@ if test "x$enable_posix_timers" = "xyes" ; then
     UCOMMON_FLAGS="$UCOMMON_FLAGS -DPOSIX_TIMERS"
 fi
 
+AC_ARG_ENABLE(utils, [  --disable-utils Do not build the utilities])
+if test "$enableval" != no; then
+    AM_CONDITIONAL([BUILD_UTILS], true),
+else
+    AM_CONDITIONAL([BUILD_UTILS], false)
+fi
+
+AC_ARG_ENABLE(tests, [  --disable-tests Do not build the tests])
+if test "$enableval" != no; then
+    AM_CONDITIONAL([BUILD_TESTS], true),
+else
+    AM_CONDITIONAL([BUILD_TESTS], false)
+fi
+
 AC_ARG_ENABLE(stdcpp,
     AC_HELP_STRING([--disable-stdcpp],
         [compile without stdc++ runtime overhead]))
